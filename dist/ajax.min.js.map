{"version":3,"sources":["ajax.js"],"names":["global","factory","exports","module","define","amd","Ajax","this","xhrObj","type","opts","postData","i","catch","mobileHandle","xmlHttp","window","XMLHttpRequest","ActiveXObject","MOBLIE_CATCH","push","open","method","url","async","withCredentials","headers","setRequestHeader","send","mergeHeaders","_headers","parseResponse","res","content","JSON","parse","responseText","e","status","data","request_1","_opts","request_2","params","key","join","stringify","Content-Type","baseUrl","prototype","then","success","error","_this","readyState","setTimeout","creatOpts","toUpperCase","ajax","methods_2","indexOf","toLowerCase","methods_1","config","j"],"mappings":"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","file":"ajax.min.js","sourcesContent":["(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n\ttypeof define === 'function' && define.amd ? define(factory) :\n\t(global.Ajax = factory());\n}(this, (function () { 'use strict';\n\n/*\r\n  xml请求构造函数\r\n*/\nfunction xhrObj(type, opts, postData) {\n\tthis.type = type;\n\tthis.opts = opts;\n\tthis.postData = postData;\n\tthis.catch = opts.catch;\n\tthis.mobileHandle = opts.mobileHandle;\n\tthis.xmlHttp = window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject('Microsoft.XMLHTTP');\n\n\tif (!!this.mobileHandle && typeof this.mobileHandle == 'function') {\n\t\tMOBLIE_CATCH.push(this.xmlHttp);\n\t\tthis.mobileHandle();\n\t}\n\n\tthis.xmlHttp.open(opts.method, opts.url, opts.async);\n\tthis.xmlHttp.withCredentials = opts.withCredentials;\n\tfor (var i in this.opts.headers) {\n\t\tthis.xmlHttp.setRequestHeader(i, this.opts.headers[i]);\n\t}\n\tif (type == \"methods_1\") {\n\t\tthis.xmlHttp.send(null);\n\t} else {\n\n\t\tthis.xmlHttp.send(this.postData);\n\t}\n\treturn this;\n}\n/*\r\n  请求回调\r\n*/\nxhrObj.prototype.then = function (success, error) {\n\tvar _this = this;\n\n\tif (this.xmlHttp.readyState == 4) {\n\t\tthis.catch(parseResponse(this.xmlHttp));\n\t\tif (this.xmlHttp.status >= 200 && this.xmlHttp.status < 300) {\n\t\t\tsuccess(parseResponse(this.xmlHttp));\n\t\t} else {\n\t\t\terror(parseResponse(this.xmlHttp));\n\t\t}\n\t} else {\n\t\tsetTimeout(function () {\n\t\t\t_this.then(success, error);\n\t\t}, 20);\n\t}\n};\n\n// 请求headers合并\nfunction mergeHeaders(headers, _headers) {\n\tfor (var i in _headers) {\n\t\theaders[i] = _headers[i];\n\t}\n\treturn _headers;\n}\n// 构建返回体\nfunction parseResponse(res) {\n\ttry {\n\t\tvar content = JSON.parse(res.responseText);\n\t} catch (e) {\n\t\tvar content = res.responseText;\n\t}\n\tvar data = {\n\t\tstatus: res.status,\n\t\tdata: content\n\t};\n\treturn data;\n}\n\nfunction request_1(_opts) {\n\treturn new xhrObj(\"methods_1\", _opts);\n}\n\nfunction request_2(_opts) {\n\tvar opts = _opts;\n\tvar params = [];\n\tfor (var key in opts.data) {\n\t\tparams.push(key + '=' + opts.data[key]);\n\t}\n\tvar postData = params.join('&');\n\tvar postData = JSON.stringify(opts.data);\n\treturn new xhrObj(\"methods_2\", opts, postData);\n}\n\nwindow.MOBLIE_CATCH = []; //预留mobile拦截数组\n\n/*\r\n    ajax构造函数\r\n*/\nfunction Ajax() {\n\t// 注册初始配置\n\tthis.opts = {};\n\tthis.opts.headers = {\n\t\t'Content-Type': 'application/json;charset=utf-8'\n\t};\n\tthis.opts.method = 'POST';\n\tthis.opts.async = true;\n\tthis.opts.data = null;\n\tthis.opts.url = \"\";\n\tthis.opts.baseUrl = \"\";\n\n\t// 默认跨域不带cookie\n\tthis.withCredentials = false;\n\n\t// 注册拦截函数\n\tthis.catch = function () {};\n\n\t// 移动端请求句柄\n\tthis.mobileHandle = null;\n}\n\n/*\r\n  整合opt\r\n*/\nAjax.prototype.creatOpts = function (opts) {\n\tvar _opts = this.opts;\n\tfor (var i in opts) {\n\t\tif (i == \"headers\") {\n\t\t\t_opts[i] = mergeHeaders(_opts[i], opts[i]);\n\t\t}\n\t\t_opts[i] = opts[i];\n\t}\n\n\t_opts.method = opts.method && opts.method.toUpperCase();\n\n\t_opts.catch = this.catch;\n\t_opts.mobileHandle = this.mobileHandle;\n\treturn _opts;\n};\n\n/*\r\n  ajax方法\r\n*/\nAjax.prototype.ajax = function (_opts) {\n\tvar opts = this.creatOpts(_opts);\n\tif (methods_2.indexOf(opts.method.toLowerCase()) !== -1) {\n\t\tvar xml = request_2(opts);\n\t\treturn xml;\n\t} else if (methods_1.indexOf(opts.method.toLowerCase()) !== -1) {\n\t\tvar xml = request_1(opts);\n\t\treturn xml;\n\t}\n\topts.url = this.opts.baseUrl + opts.url;\n\treturn new xhrObj(opts, xmlHttp);\n};\n\n/*\r\n  暴露一个配置方法\r\n*/\nAjax.prototype.config = function (opts) {\n\tfor (var i in opts) {\n\t\tif (i == \"headers\") {\n\t\t\topts[i] = mergeHeaders(this.opts[i], opts[i]);\n\t\t\tcontinue;\n\t\t}\n\t\tthis.opts[i] = opts[i];\n\t}\n};\n\n// 请求方法集合\nvar methods_1 = ['get', 'delete', 'head', 'options']; //不带data\nvar methods_2 = ['post', 'put', 'patch']; //带data\nfor (var i in methods_1) {\n\t!function (methods_1, i) {\n\t\tAjax.prototype[methods_1[i]] = function (url, _opts) {\n\n\t\t\tvar opts = this.creatOpts(_opts || {});\n\t\t\topts.method = methods_1[i].toUpperCase();\n\t\t\topts.url = this.opts.baseUrl + url;\n\n\t\t\tvar xml = request_1(opts);\n\t\t\treturn xml;\n\t\t};\n\t}(methods_1, i);\n}\nfor (var j in methods_2) {\n\t!function (methods_2, j) {\n\t\tAjax.prototype[methods_2[j]] = function (url, data, opts) {\n\t\t\topts = this.creatOpts(opts || {});\n\t\t\topts.method = methods_2[j].toUpperCase();\n\t\t\topts.url = this.opts.baseUrl + url;\n\t\t\topts.data = data || {};\n\n\t\t\tvar xml = request_2(opts);\n\t\t\treturn xml;\n\t\t};\n\t}(methods_2, j);\n}\n\n// 检验是否浏览器环境\ntry {\n    \n} catch (ex) {\n    throw new Error('请在浏览器环境下运行');\n}\n\nvar index = new Ajax();\n\nreturn index;\n\n})));\n"]}